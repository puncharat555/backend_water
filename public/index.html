<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Water Level Monitoring</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <h1>Water Level Monitoring</h1>

  <div class="container">
    <!-- Node 1 -->
    <div class="node-box">
      <h2>Node 1</h2>
      <p id="waterLevelNode1">ระดับน้ำ: -</p>
      <p id="rssiNode1">RSSI: -</p>
      <p id="voltageNode1">แรงดัน: -</p>
      <p id="currentNode1">กระแส: -</p>
      <p id="timeNode1">เวลาวัด: -</p>
    </div>

    <!-- Node 2 -->
    <div class="node-box">
      <h2>Node 2</h2>
      <p id="rssiNode2">RSSI: -</p>
      <p id="voltageNode2">แรงดัน: -</p>
      <p id="currentNode2">กระแส: -</p>
      <p id="timeNode2">เวลาวัด: -</p>
    </div>
  </div>

  <script>
    const fixedDepth = 120;

    async function loadData() {
      try {
        const res = await fetch('https://backend-water-rf88.onrender.com/distance');
        const data = await res.json();

        // Node 1: ต้องมี distance > 0
        const latestNode1 = [...data].reverse().find(item => item.distance > 0);
        const latestNode2 = [...data].reverse().find(item =>
          item.rssi_node2 !== undefined || item.v_node2 !== undefined || item.i_node2 !== undefined
        );

        // Node 1 display
        if (latestNode1) {
          const level = (fixedDepth - latestNode1.distance).toFixed(1);
          document.getElementById('waterLevelNode1').innerText = `ระดับน้ำ: ${level} cm`;
          document.getElementById('rssiNode1').innerText = `RSSI: ${latestNode1.rssi_node1 ?? '-'}`;
          document.getElementById('voltageNode1').innerText = `แรงดัน: ${latestNode1.v_node1 ?? '-'}`;
          document.getElementById('currentNode1').innerText = `กระแส: ${latestNode1.i_node1 ?? '-'}`;
          document.getElementById('timeNode1').innerText = `เวลาวัด: ${latestNode1.time_node1 ?? '-'}`;
        }

        // Node 2 display
        if (latestNode2) {
          document.getElementById('rssiNode2').innerText = `RSSI: ${latestNode2.rssi_node2 ?? '-'}`;
          document.getElementById('voltageNode2').innerText = `แรงดัน: ${latestNode2.v_node2 ?? '-'}`;
          document.getElementById('currentNode2').innerText = `กระแส: ${latestNode2.i_node2 ?? '-'}`;
          document.getElementById('timeNode2').innerText = `เวลาวัด: ${latestNode2.time_node2 ?? '-'}`;
        }

      } catch (error) {
        console.error('Load data error:', error);
      }
    }

    loadData();
    setInterval(loadData, 5000);
  </script>
</body>
</html>
